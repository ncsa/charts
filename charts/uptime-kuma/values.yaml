# Default values for uptime-kuma.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# NOTE: Uptime Kuma does not support multiple replicas due to SQLite database.
# The deployment is hardcoded to 1 replica.

image:
  repository: louislam/uptime-kuma
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext:
  fsGroup: 1000
  fsGroupChangePolicy: OnRootMismatch

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  seccompProfile:
    type: RuntimeDefault

service:
  type: ClusterIP
  port: 3001

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: uptime-kuma.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []
  #  - secretName: uptime-kuma-tls
  #    hosts:
  #      - uptime-kuma.local

# Persistence configuration for /app/data
# WARNING: Do NOT use NFS or network storage! This will cause SQLite database corruption
# due to file locking issues. Use local storage or a volume with proper POSIX file locking support.
persistence:
  enabled: true
  # Use an existing PVC if specified
  # existingClaim: uptime-kuma-data
  size: 4Gi
  accessMode: ReadWriteOncePod
  # storageClass: "-"  # Use default storage class
  # Optionally specify a storage class that provides local/non-NFS storage
  storageClass: ""
  # Fix permissions for restricted storage backends (e.g., Cinder CSI)
  # When enabled, an init container will create a data subdirectory with proper permissions
  # and the app will be mounted into that subdirectory instead of the volume root.
  # Set to true if the app fails with "permission denied" errors on write operations.
  fixPermissions: false

# NSCD (Name Service Cache Daemon) configuration
# Uptime Kuma tries to start NSCD for DNS caching but fails due to security restrictions.
# This results in log messages: "Starting nscd" followed by "Failed to start nscd"
# These messages are harmless and can be ignored if NSCD is disabled.
#
# To enable NSCD caching (optional performance improvement):
# - Set nscd.enabled to true
# - A sidecar container will run NSCD as root with minimal privileges
# - The main container will automatically use NSCD for DNS lookups
# - The "Failed to start nscd" message will still appear but NSCD will work via sidecar
nscd:
  enabled: false
  # Resource limits for the NSCD sidecar container (when enabled)
  # NSCD is very lightweight - observed usage: ~2-5MiB memory, <1% CPU
  resources:
    limits:
      cpu: 50m
      memory: 32Mi
    requests:
      cpu: 10m
      memory: 16Mi

resources: {}
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  #
  # Based on observed usage: ~500MiB memory steady, CPU spikes to 100% during page loads
  # limits:
  #   cpu: 1000m
  #   memory: 1Gi
  # requests:
  #   cpu: 100m
  #   memory: 512Mi

nodeSelector: {}

tolerations: []

affinity: {}
